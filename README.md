# Prueba T√©cnica - Microservicios Clean Architecture

## üèóÔ∏è Descripci√≥n general

Este proyecto implementa un conjunto de **microservicios desarrollados en .NET 7**, basados en una adaptaci√≥n de **Clean Architecture**, que incluyen:

‚úÖ **JWT Authentication** (AES-256 CBC en claims)  
‚úÖ **UnitOfWork + Repositorio Gen√©rico**  
‚úÖ **JSON:API** como contrato uniforme  
‚úÖ **Logs estructurados con Serilog**  
‚úÖ **HealthChecks** expuestos en `/health`  
‚úÖ **Pruebas unitarias (xUnit + Moq)** con +80% cobertura

El dise√±o sigue el principio de **Clean Architecture**, donde las dependencias siempre est√°n dirigidas hacia afuera.

---

## üîí JWT Authentication

- Configuraci√≥n de `Issuer`, `Audience` y expiraci√≥n (`JwtExpired`) en `appsettings.json`.
- La clave `SecretKey` no est√° expuesta en el archivo, se obtiene desde:

    AppConstants.CryptoKeys.KeyToken

### Encriptaci√≥n de claims y datos cr√≠ticos

- Usamos AES-256 con `CipherMode.CBC`.
- La llave para encriptaci√≥n proviene de:

    AppConstants.CryptoKeys.KeyCrypto

---

## ‚öôÔ∏è Configuraci√≥n de conexi√≥n cifrada

El archivo `appsettings.json` contiene placeholders para las cadenas de conexi√≥n y niveles de seguridad:

    "ConnectionStrings": {
      "Db": "Server=[SERVER];DataBase=[DATABASE];User=[USER];Password=[PASSWORD];..."
```    },
    "Levels": {
      "Level1": "...",
      "Level2": "...",
      "Level3": "...",
      "Level4": "..."
```    }

Estos valores son desencriptados mediante `CryptoHelper` usando claves definidas en `AppConstants.CryptoKeys`.

## üíæ Health Checks

Expuestos en la ruta:

    /health

Ejemplo:

    https://localhost:{PORT}/health

---

## üìú Logs estructurados con Serilog

Serilog gestiona logs estructurados a nivel global, capturando:

- Errores no controlados (por ejemplo, fallos de infraestructura).
- Errores de negocio (`ApplicationException`).

Ejemplo de log:

    {
      "@t": "2025-06-27T01:23:45Z",
      "@m": "Error de validaci√≥n o negocio",
      "@l": "Warning",
      "@x": "System.ApplicationException: Usuario y/o password inv√°lidos"
```    }


## üì¶ Respuestas JSON:API estandarizadas

### ‚úÖ √âxito (`200 OK`)

    {
      "data": {
        "type": "producto",
        "attributes": {
          "idProducto": 1,
          "nombreProducto": "Producto A",
          "descripcion": "Prueba",
          "precio": 1000,
          "activo": true
        }
      },
      "meta": {
        "success": true,
        "message": "Petici√≥n ejecutada de forma correcta"
```      }
    }
```
---

### ‚ö†Ô∏è Error de negocio (`400 BadRequest`)

    {
      "errors": [
        {
          "status": "400",
          "title": "Bad Request",
          "detail": "Ya existe un producto con el nombre: Producto A"
```        }
      ],
      "meta": {
        "success": false,
        "message": "Error al procesar la solicitud. Valide los valores enviados."
```      }
    }
```
---

### üîç No encontrado (`404 NotFound`)

    {
      "errors": [
        {
          "status": "404",
          "title": "NotFound",
          "detail": "No existe un producto con ID = 123"
```        }
      ],
      "meta": {
        "success": false,
        "message": "Error al obtener producto"
```      }
    }
```
---

### üí• Error inesperado (`500 InternalServerError`)

    {
      "errors": [
        {
          "status": "500",
          "title": "Internal Server Error",
          "detail": "Ha ocurrido un error inesperado."
```        }

## üß™ Pruebas unitarias

- Se usa **xUnit + Moq** para probar la capa `Application`.
- Se cubren escenarios como:
  - Creaci√≥n v√°lida y detecci√≥n de duplicados.
  - Consultas de producto por ID (existente / no existente).
  - Simulaci√≥n de fallos en repositorio (errores de base de datos).

---

## üê≥ Dockerizaci√≥n futura

**NOTA:**  
Por temas de tiempo no se alcanz√≥ a dockerizar completamente.  
Se definir√° un stack que incluya:

- **SQL Server**
- Variables de entorno seguras para claves JWT y conexi√≥n cifrada.

---

## üóÑÔ∏è Scripts de base de datos y modelos ER

### Microservicio Seguridad (`SeguridadService`)### Microservicio Seguridad (SeguridadService)

SCRIPT SQL:

IF NOT EXISTS (SELECT * FROM sys.schemas WHERE name = 'Usuarios')
BEGIN
    EXEC('CREATE SCHEMA Usuarios');
END;
GO

IF NOT EXISTS (
    SELECT * FROM INFORMATION_SCHEMA.TABLES 
    WHERE TABLE_SCHEMA = 'Usuarios' AND TABLE_NAME = 'Usuario'
```)
BEGIN
    CREATE TABLE [Usuarios].[Usuario]
    (
        IdUsuario INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
        Nombre NVARCHAR(100) NOT NULL,
        Login NVARCHAR(50) NOT NULL UNIQUE,
        Password NVARCHAR(255) NOT NULL,
        Activo BIT NOT NULL DEFAULT 1,
        UsuarioCreacion SMALLINT NOT NULL,
        FechaCreacion DATETIME NOT NULL DEFAULT GETDATE(),
        UsuarioModificacion SMALLINT NULL,
        FechaModificacion DATETIME NULL
    );
END;
GO

---

MODELO ENTIDAD RELACI√ìN SeguridadService:

Entidad: Usuarios.Usuario
---------------------------------
- IdUsuario (PK)
- Nombre
- Login (UNIQUE)
- Password
- Activo
- UsuarioCreacion
- FechaCreacion
- UsuarioModificacion
- FechaModificacion

(No hay claves for√°neas en este microservicio)


### Microservicio Compras (ComprasService)

SCRIPT SQL:

IF NOT EXISTS (SELECT * FROM sys.schemas WHERE name = 'Compras')
BEGIN
    EXEC('CREATE SCHEMA Compras');
END;
GO

IF NOT EXISTS (
    SELECT * FROM INFORMATION_SCHEMA.TABLES 
    WHERE TABLE_SCHEMA = 'Compras' AND TABLE_NAME = 'Compra'
```)
BEGIN
    CREATE TABLE [Compras].[Compra]
    (
        IdCompra INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
        IdCliente INT NOT NULL,
        IdMovimientoInventario INT NOT NULL,
        FechaCompra DATETIME NOT NULL DEFAULT GETDATE(),
        TotalItems INT NOT NULL,
        ValorTotalCompra DECIMAL(18,2) NOT NULL,
        UsuarioCreacion SMALLINT NOT NULL,
        FechaCreacion DATETIME NOT NULL DEFAULT GETDATE(),
        UsuarioModificacion SMALLINT NULL,
        FechaModificacion DATETIME NULL
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM INFORMATION_SCHEMA.TABLES 
    WHERE TABLE_SCHEMA = 'Compras' AND TABLE_NAME = 'CompraDetalle'
```)
BEGIN
    CREATE TABLE [Compras].[CompraDetalle]
    (
        IdCompraDetalle INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
        IdCompra INT NOT NULL,
        IdProducto INT NOT NULL,
        CantidadProducto INT NOT NULL,
        UsuarioCreacion SMALLINT NOT NULL,
        FechaCreacion DATETIME NOT NULL DEFAULT GETDATE(),
        UsuarioModificacion SMALLINT NULL,
        FechaModificacion DATETIME NULL,
        CONSTRAINT FK_CompraDetalle_Compra FOREIGN KEY (IdCompra)
            REFERENCES [Compras].[Compra](IdCompra)
    );
END;
GO

---

MODELO ENTIDAD RELACI√ìN ComprasService:

Entidad: Compras.Compra
---------------------------------
- IdCompra (PK)
- IdCliente
- IdMovimientoInventario
- FechaCompra
- TotalItems
- ValorTotalCompra
- UsuarioCreacion
- FechaCreacion
- UsuarioModificacion
- FechaModificacion

Entidad: Compras.CompraDetalle
---------------------------------
- IdCompraDetalle (PK)
- IdCompra (FK ‚Üí Compras.Compra.IdCompra)
- IdProducto
- CantidadProducto
- UsuarioCreacion
- FechaCreacion
- UsuarioModificacion
- FechaModificacion

### Microservicio Productos (ProductosService)

SCRIPT SQL:

DROP TABLE IF EXISTS [Productos].[Producto];
GO

IF NOT EXISTS (SELECT * FROM sys.schemas WHERE name = 'Productos')
BEGIN
    EXEC('CREATE SCHEMA Productos');
END;
GO

IF NOT EXISTS (
    SELECT * FROM INFORMATION_SCHEMA.TABLES 
    WHERE TABLE_SCHEMA = 'Productos' AND TABLE_NAME = 'Producto'
```)
BEGIN
    CREATE TABLE [Productos].[Producto]
    (
        IdProducto INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
        NombreProducto NVARCHAR(100) NOT NULL,
        Descripcion NVARCHAR(255) NULL,
        Precio DECIMAL(18,2) NOT NULL,
        Activo BIT NOT NULL DEFAULT 1,
        UsuarioCreacion SMALLINT NOT NULL,
        FechaCreacion DATETIME NOT NULL DEFAULT GETDATE(),
        UsuarioModificacion SMALLINT NULL,
        FechaModificacion DATETIME NULL
    );
END;
GO

---

MODELO ENTIDAD RELACI√ìN ProductosService:

Entidad: Productos.Producto
---------------------------------
- IdProducto (PK)
- NombreProducto
- Descripcion
- Precio
- Activo
- UsuarioCreacion
- FechaCreacion
- UsuarioModificacion
- FechaModificacion


### Microservicio Inventarios (InventariosService)

SCRIPT SQL:

IF NOT EXISTS (SELECT * FROM sys.schemas WHERE name = 'Inventarios')
BEGIN
    EXEC('CREATE SCHEMA Inventarios');
END;
GO

IF NOT EXISTS (
    SELECT * FROM INFORMATION_SCHEMA.TABLES 
    WHERE TABLE_SCHEMA = 'Inventarios' AND TABLE_NAME = 'Inventario'
```)
BEGIN
    CREATE TABLE [Inventarios].[Inventario]
    (
        IdInventario INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
        IdProducto INT NOT NULL UNIQUE,
        ExistenciasActuales INT NOT NULL,
        UsuarioCreacion SMALLINT NOT NULL,
        FechaCreacion DATETIME NOT NULL DEFAULT GETDATE(),
        UsuarioModificacion SMALLINT,
        FechaModificacion DATETIME NULL
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM INFORMATION_SCHEMA.TABLES 
    WHERE TABLE_SCHEMA = 'Inventarios' AND TABLE_NAME = 'InventarioMovimiento'
```)
BEGIN
    CREATE TABLE Inventarios.InventarioMovimiento
    (
      IdMovimiento INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
      TipoMovimiento TINYINT NOT NULL,
      Observaciones VARCHAR(255) NULL,
      UsuarioCreacion SMALLINT NOT NULL,
      FechaCreacion DATETIME NOT NULL DEFAULT GETDATE()
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM INFORMATION_SCHEMA.TABLES 
    WHERE TABLE_SCHEMA = 'Inventarios' AND TABLE_NAME = 'InventarioMovimientoDetalle'
```)
BEGIN
    CREATE TABLE Inventarios.InventarioMovimientoDetalle
    (
      IdMovimientoDetalle INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
      IdMovimiento INT NOT NULL,
      IdInventario INT NOT NULL,
      CantidadAntes INT NOT NULL,
      CantidadMovimiento INT NOT NULL,
      CantidadDespues INT NOT NULL,
      Observaciones VARCHAR(255) NULL,
      UsuarioCreacion SMALLINT NOT NULL,
      FechaCreacion DATETIME NOT NULL DEFAULT GETDATE(),
      CONSTRAINT FK_InventarioMovimientoDetalle_InventarioMovimiento 
          FOREIGN KEY (IdMovimiento)
          REFERENCES Inventarios.InventarioMovimiento(IdMovimiento),
      CONSTRAINT FK_InventarioMovimientoDetalle_Inventario 
          FOREIGN KEY (IdInventario)
          REFERENCES Inventarios.Inventario(IdInventario)
    );
END;
GO

---

MODELO ENTIDAD RELACI√ìN InventariosService:

Entidad: Inventarios.Inventario
---------------------------------
- IdInventario (PK)
- IdProducto (UNIQUE)
- ExistenciasActuales
- UsuarioCreacion
- FechaCreacion
- UsuarioModificacion
- FechaModificacion

Entidad: Inventarios.InventarioMovimiento
---------------------------------
- IdMovimiento (PK)
- TipoMovimiento
- Observaciones
- UsuarioCreacion
- FechaCreacion

Entidad: Inventarios.InventarioMovimientoDetalle
---------------------------------
- IdMovimientoDetalle (PK)
- IdMovimiento (FK ‚Üí Inventarios.InventarioMovimiento.IdMovimiento)
- IdInventario (FK ‚Üí Inventarios.Inventario.IdInventario)
- CantidadAntes
- CantidadMovimiento
- CantidadDespues
- Observaciones
- UsuarioCreacion
- FechaCreacion


## üìÇ Estructura del microservicio SeguridadService

```plaintext
SeguridadService.sln
‚îÇ
‚îú‚îÄ‚îÄ‚îÄSeguridadService.Application
‚îÇ   ‚îÇ   SeguridadService.Application.csproj
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄDto
‚îÇ   ‚îÇ   ‚îÇ   LoggedDto.cs
‚îÇ   ‚îÇ   ‚îÇ   LoginRequestDto.cs
‚îÇ   ‚îÇ   ‚îÇ   LoginResponseDto.cs
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄJsonResponse
‚îÇ   ‚îÇ           JsonApiData.cs
‚îÇ   ‚îÇ           JsonApiError.cs
‚îÇ   ‚îÇ           JsonApiErrorResponse.cs
‚îÇ   ‚îÇ           JsonApiResponse.cs
‚îÇ   ‚îÇ           Meta.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄExceptions
‚îÇ   ‚îÇ       ApplicationException.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄHelpers
‚îÇ   ‚îÇ       CryptoHelper.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄInterfaces
‚îÇ   ‚îÇ       ICryptoHelper.cs
‚îÇ   ‚îÇ       ILoginService.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄMapping
‚îÇ   ‚îÇ       Mapper.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄServices
‚îÇ           LoginService.cs
‚îÇ           ServiceBase.cs
‚îÇ
‚îú‚îÄ‚îÄ‚îÄSeguridadService.Common
‚îÇ   ‚îÇ   AppConstants.cs
‚îÇ   ‚îÇ   Crypto.cs
‚îÇ   ‚îÇ   SeguridadService.Common.csproj
‚îÇ
‚îú‚îÄ‚îÄ‚îÄSeguridadService.Domain
‚îÇ   ‚îÇ   SeguridadService.Domain.csproj
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄEntities
‚îÇ   ‚îÇ       Usuario.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄInterfaces
‚îÇ       ‚îî‚îÄ‚îÄ‚îÄRepositorio
‚îÇ               IGenericRepository.cs
‚îÇ               IUnitOfWork.cs
‚îÇ
‚îú‚îÄ‚îÄ‚îÄSeguridadService.Infraestructure
‚îÇ   ‚îÇ   SeguridadService.Infraestructure.csproj
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄContext
‚îÇ   ‚îÇ       ContextSeguridad.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄRepository
‚îÇ           GenericRepository.cs
‚îÇ           UnitOfWork.cs
‚îÇ
‚îú‚îÄ‚îÄ‚îÄSeguridadService.Service
‚îÇ   ‚îÇ   appsettings.Development.json
‚îÇ   ‚îÇ   appsettings.json
‚îÇ   ‚îÇ   Program.cs
‚îÇ   ‚îÇ   SeguridadService.Service.csproj
‚îÇ   ‚îÇ   SeguridadService.Service.csproj.user
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄControllers
‚îÇ   ‚îÇ       LoginController.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄHealthChecks
‚îÇ   ‚îÇ       HealthCheckConfig.cs
‚îÇ   ‚îÇ       LoggingHealthCheckPublisher.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄHelpers
‚îÇ   ‚îÇ       ConfigurationExtensions.cs
‚îÇ   ‚îÇ       JsonApiResponseFactory.cs
‚îÇ   ‚îÇ       JwtHelper.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄMiddleware
‚îÇ   ‚îÇ       GlobalExceptionMiddleware.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄProperties
‚îÇ           launchSettings.json
‚îÇ
‚îú‚îÄ‚îÄ‚îÄSeguridadService.UnitTests
‚îÇ   ‚îÇ   SeguridadService.UnitTests.csproj
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄSeguridadService.Tests
‚îÇ       ‚îî‚îÄ‚îÄ‚îÄApplication
‚îÇ           ‚îî‚îÄ‚îÄ‚îÄServices
‚îÇ                   SeguridadServiceTests.cs


## üìÇ Estructura del microservicio ProductosService

```plaintext
ProductosService.sln
‚îÇ
‚îú‚îÄ‚îÄ‚îÄProductosService.Application
‚îÇ   ‚îÇ   ProductosService.Application.csproj
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄDto
‚îÇ   ‚îÇ   ‚îÇ   ProductoDto.cs
‚îÇ   ‚îÇ   ‚îÇ   ProductoNuevoDto.cs
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄJsonResponse
‚îÇ   ‚îÇ           JsonApiData.cs
‚îÇ   ‚îÇ           JsonApiError.cs
‚îÇ   ‚îÇ           JsonApiErrorResponse.cs
‚îÇ   ‚îÇ           JsonApiResponse.cs
‚îÇ   ‚îÇ           Meta.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄExceptions
‚îÇ   ‚îÇ       ApplicationException.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄHelpers
‚îÇ   ‚îÇ       CryptoHelper.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄInterfaces
‚îÇ   ‚îÇ       ICryptoHelper.cs
‚îÇ   ‚îÇ       ICurrentUserService.cs
‚îÇ   ‚îÇ       IProductoService.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄMapping
‚îÇ   ‚îÇ       Mapper.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄServices
‚îÇ           ProductoService.cs
‚îÇ           ServiceBase.cs
‚îÇ
‚îú‚îÄ‚îÄ‚îÄProductosService.Common
‚îÇ   ‚îÇ   AppConstants.cs
‚îÇ   ‚îÇ   Crypto.cs
‚îÇ   ‚îÇ   ProductosService.Common.csproj
‚îÇ
‚îú‚îÄ‚îÄ‚îÄProductosService.Domain
‚îÇ   ‚îÇ   ProductosService.Domain.csproj
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄEntities
‚îÇ   ‚îÇ       Producto.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄInterfaces
‚îÇ       ‚îî‚îÄ‚îÄ‚îÄRepositorio
‚îÇ               IGenericRepository.cs
‚îÇ               IUnitOfWork.cs
‚îÇ
‚îú‚îÄ‚îÄ‚îÄProductosService.Infraestructure
‚îÇ   ‚îÇ   ProductosService.Infraestructure.csproj
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄContext
‚îÇ   ‚îÇ       ContextProductos.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄRepository
‚îÇ           GenericRepository.cs
‚îÇ           UnitOfWork.cs
‚îÇ
‚îú‚îÄ‚îÄ‚îÄProductosService.Service
‚îÇ   ‚îÇ   appsettings.Development.json
‚îÇ   ‚îÇ   appsettings.json
‚îÇ   ‚îÇ   ProductosService.Service.csproj
‚îÇ   ‚îÇ   ProductosService.Service.csproj.user
‚îÇ   ‚îÇ   Program.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄControllers
‚îÇ   ‚îÇ       ProductosController.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄHealthChecks
‚îÇ   ‚îÇ       HealthCheckConfig.cs
‚îÇ   ‚îÇ       LoggingHealthCheckPublisher.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄHelpers
‚îÇ   ‚îÇ       ConfigurationExtensions.cs
‚îÇ   ‚îÇ       CurrentUserService.cs
‚îÇ   ‚îÇ       JsonApiResponseFactory.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄMiddleware
‚îÇ   ‚îÇ       GlobalExceptionMiddleware.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄProperties
‚îÇ           launchSettings.json
‚îÇ
‚îî‚îÄ‚îÄ‚îÄProductosService.UnitTests
    ‚îÇ   ProductosService.UnitTests.csproj
    ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄProductosService.Tests
        ‚îî‚îÄ‚îÄ‚îÄApplication
            ‚îî‚îÄ‚îÄ‚îÄServices
                    ProductoServiceTests.cs



## üìÇ Estructura del microservicio InventariosService

```plaintext
InventariosService.sln
‚îÇ
‚îú‚îÄ‚îÄ‚îÄInventariosService.Application
‚îÇ   ‚îÇ   InventariosService.Application.csproj
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄDto
‚îÇ   ‚îÇ   ‚îÇ   ActualizaInventarioDto.cs
‚îÇ   ‚îÇ   ‚îÇ   InventarioCompraActualizadoDto.cs
‚îÇ   ‚îÇ   ‚îÇ   InventarioMovimientoDto.cs
‚îÇ   ‚îÇ   ‚îÇ   InventarioProductoDto.cs
‚îÇ   ‚îÇ   ‚îÇ   ProductoInventarioDto.cs
‚îÇ   ‚îÇ   ‚îÇ   ProductosCompraDto.cs
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ‚îÄIntegrations
‚îÇ   ‚îÇ   ‚îÇ       ProductoDto.cs
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄJsonResponse
‚îÇ   ‚îÇ           JsonApiData.cs
‚îÇ   ‚îÇ           JsonApiError.cs
‚îÇ   ‚îÇ           JsonApiErrorResponse.cs
‚îÇ   ‚îÇ           JsonApiResponse.cs
‚îÇ   ‚îÇ           Meta.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄEnumerations
‚îÇ   ‚îÇ       Enumeration.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄExceptions
‚îÇ   ‚îÇ       ApplicationException.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄHelpers
‚îÇ   ‚îÇ       CryptoHelper.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄInterfaces
‚îÇ   ‚îÇ   ‚îÇ   ICryptoHelper.cs
‚îÇ   ‚îÇ   ‚îÇ   ICurrentUserService.cs
‚îÇ   ‚îÇ   ‚îÇ   IInventarioService.cs
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄIntegrations
‚îÇ   ‚îÇ           IProductoApiService.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄMapping
‚îÇ   ‚îÇ       Mapper.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄServices
‚îÇ           InventarioService.cs
‚îÇ           ServiceBase.cs
‚îÇ
‚îú‚îÄ‚îÄ‚îÄInventariosService.Common
‚îÇ   ‚îÇ   AppConstants.cs
‚îÇ   ‚îÇ   Crypto.cs
‚îÇ   ‚îÇ   InventariosService.Common.csproj
‚îÇ
‚îú‚îÄ‚îÄ‚îÄInventariosService.Domain
‚îÇ   ‚îÇ   InventariosService.Domain.csproj
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄEntities
‚îÇ   ‚îÇ       Inventario.cs
‚îÇ   ‚îÇ       InventarioMovimiento.cs
‚îÇ   ‚îÇ       InventarioMovimientoDetalle.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄInterfaces
‚îÇ       ‚îî‚îÄ‚îÄ‚îÄRepositorio
‚îÇ               IGenericRepository.cs
‚îÇ               ITransaction.cs
‚îÇ               IUnitOfWork.cs
‚îÇ
‚îú‚îÄ‚îÄ‚îÄInventariosService.Infraestructure
‚îÇ   ‚îÇ   InventariosService.Infraestructure.csproj
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄContext
‚îÇ   ‚îÇ       ContextInventarios.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄRepository
‚îÇ           EfTransaction.cs
‚îÇ           GenericRepository.cs
‚îÇ           UnitOfWork.cs
‚îÇ
‚îú‚îÄ‚îÄ‚îÄInventariosService.Infraestructure.Integrations
‚îÇ   ‚îÇ   InventariosService.Infraestructure.Integrations.csproj
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄServices
‚îÇ           ProductoApiService.cs
‚îÇ
‚îú‚îÄ‚îÄ‚îÄInventariosService.Service
‚îÇ   ‚îÇ   appsettings.Development.json
‚îÇ   ‚îÇ   appsettings.json
‚îÇ   ‚îÇ   InventariosService.Service.csproj
‚îÇ   ‚îÇ   InventariosService.Service.csproj.user
‚îÇ   ‚îÇ   Program.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄControllers
‚îÇ   ‚îÇ       InventariosController.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄHealthChecks
‚îÇ   ‚îÇ       HealthCheckConfig.cs
‚îÇ   ‚îÇ       LoggingHealthCheckPublisher.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄHelpers
‚îÇ   ‚îÇ       ConfigurationExtensions.cs
‚îÇ   ‚îÇ       CurrentUserService.cs
‚îÇ   ‚îÇ       JsonApiResponseFactory.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄLogs
‚îÇ   ‚îÇ       log-20250628.json
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄMiddleware
‚îÇ   ‚îÇ       GlobalExceptionMiddleware.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄProperties
‚îÇ           launchSettings.json
‚îÇ
‚îî‚îÄ‚îÄ‚îÄInventariosService.UnitTests
    ‚îÇ   InventariosService.UnitTests.csproj
    ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄInventariosService.Tests
    ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄApplication
    ‚îÇ       ‚îî‚îÄ‚îÄ‚îÄServices
    ‚îÇ               InventarioServiceTests.cs


## üìÇ Estructura del microservicio ComprasService

```plaintext
ComprasService.sln
‚îÇ
‚îú‚îÄ‚îÄ‚îÄComprasService.Application
‚îÇ   ‚îÇ   ComprasService.Application.csproj
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄDto
‚îÇ   ‚îÇ   ‚îÇ   CompraDetalleDto.cs
‚îÇ   ‚îÇ   ‚îÇ   CompraDto.cs
‚îÇ   ‚îÇ   ‚îÇ   RegistraCompraDto.cs
‚îÇ   ‚îÇ   ‚îÇ   RegistrarCompraDetalleDto.cs
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ‚îÄIntegrations
‚îÇ   ‚îÇ   ‚îÇ       InventarioCompraActualizadoDto.cs
‚îÇ   ‚îÇ   ‚îÇ       InventarioProductoDto.cs
‚îÇ   ‚îÇ   ‚îÇ       ProductoDto.cs
‚îÇ   ‚îÇ   ‚îÇ       ProductosCompraDto.cs
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄJsonResponse
‚îÇ   ‚îÇ           JsonApiData.cs
‚îÇ   ‚îÇ           JsonApiError.cs
‚îÇ   ‚îÇ           JsonApiErrorResponse.cs
‚îÇ   ‚îÇ           JsonApiResponse.cs
‚îÇ   ‚îÇ           Meta.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄExceptions
‚îÇ   ‚îÇ       ApplicationException.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄHelpers
‚îÇ   ‚îÇ       CryptoHelper.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄInterfaces
‚îÇ   ‚îÇ   ‚îÇ   ICompraService.cs
‚îÇ   ‚îÇ   ‚îÇ   ICryptoHelper.cs
‚îÇ   ‚îÇ   ‚îÇ   ICurrentUserService.cs
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄIntegrations
‚îÇ   ‚îÇ           IInventarioApiService.cs
‚îÇ   ‚îÇ           IProductoApiService.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄMapping
‚îÇ   ‚îÇ       Mapper.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄServices
‚îÇ           CompraService.cs
‚îÇ           ServiceBase.cs
‚îÇ
‚îú‚îÄ‚îÄ‚îÄComprasService.Common
‚îÇ   ‚îÇ   AppConstants.cs
‚îÇ   ‚îÇ   ComprasService.Common.csproj
‚îÇ   ‚îÇ   Crypto.cs
‚îÇ
‚îú‚îÄ‚îÄ‚îÄComprasService.Domain
‚îÇ   ‚îÇ   ComprasService.Domain.csproj
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄEntities
‚îÇ   ‚îÇ       Compra.cs
‚îÇ   ‚îÇ       CompraDetalle.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄInterfaces
‚îÇ       ‚îî‚îÄ‚îÄ‚îÄRepositorio
‚îÇ               IGenericRepository.cs
‚îÇ               IUnitOfWork.cs
‚îÇ
‚îú‚îÄ‚îÄ‚îÄComprasService.Infraestructure
‚îÇ   ‚îÇ   ComprasService.Infraestructure.csproj
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄContext
‚îÇ   ‚îÇ       ContextCompras.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄRepository
‚îÇ           GenericRepository.cs
‚îÇ           UnitOfWork.cs
‚îÇ
‚îú‚îÄ‚îÄ‚îÄComprasService.Infraestructure.Integrations
‚îÇ   ‚îÇ   ComprasService.Infraestructure.Integrations.csproj
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄServices
‚îÇ           InventarioApiService.cs
‚îÇ           ProductoApiService.cs
‚îÇ
‚îú‚îÄ‚îÄ‚îÄComprasService.Service
‚îÇ   ‚îÇ   appsettings.Development.json
‚îÇ   ‚îÇ   appsettings.json
‚îÇ   ‚îÇ   ComprasService.Service.csproj
‚îÇ   ‚îÇ   ComprasService.Service.csproj.user
‚îÇ   ‚îÇ   Program.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄControllers
‚îÇ   ‚îÇ       ComprasController.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄHealthChecks
‚îÇ   ‚îÇ       HealthCheckConfig.cs
‚îÇ   ‚îÇ       LoggingHealthCheckPublisher.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄHelpers
‚îÇ   ‚îÇ       ConfigurationExtensions.cs
‚îÇ   ‚îÇ       CurrentUserService.cs
‚îÇ   ‚îÇ       JsonApiResponseFactory.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄLogs
‚îÇ   ‚îÇ       log-20250628.json
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄMiddleware
‚îÇ   ‚îÇ       GlobalExceptionMiddleware.cs
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄProperties
‚îÇ           launchSettings.json
‚îÇ
‚îî‚îÄ‚îÄ‚îÄComprasService.UnitTests
    ‚îÇ   ComprasService.UnitTests.csproj
    ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄComprasService.Tests
        ‚îî‚îÄ‚îÄ‚îÄApplication
            ‚îî‚îÄ‚îÄ‚îÄServices
                    ComprasServiceTests.cs

---


## üöÄ Ejemplos de consumo del API ComprasService

### üî• POST `/api/compras/registrar-compra`

Registra una nueva compra en el sistema.

#### üì§ Request
```bash
```bash
curl -X POST https://localhost:7150/api/Compras/registrar-compra   -H "Authorization: Bearer TU_TOKEN_AQUI"   -H "Content-Type: application/json"   -d 
'{
  "idCliente": 45,
  "productos": [
    {
      "idProducto": 2,
      "cantidadProducto": 10
    }
  ]
}'
``````

#### ‚úÖ Response JSON:API (`200 OK`)
```json
```json
{
  "data": {
    "type": "compra",
    "attributes": {
      "idCompra": 2,
      "idCliente": 45,
      "fechaCompra": "2025-06-28T21:21:10.193",
      "totalItems": 1,
      "valorTotalCompra": 123000,
      "productos": [
        {
          "idProducto": 2,
          "nombreProducto": "Crema Colgate 50mg",
          "cantidadProducto": 10,
          "precioUnitario": 12300,
          "total": 123000
        }
      ]
    }
  },
  "meta": {
    "success": true,
    "message": "Compra registrada correctamete"
```  }
}
```

---

### üìö GET `/api/compras/obtener-compras`

Obtiene todas las compras registradas.

#### üì§ Request
```bash
```bash
curl -X GET https://localhost:7150/api/Compras/obtener-compras   -H "Authorization: Bearer TU_TOKEN_AQUI"
``````

#### ‚úÖ Response JSON:API (`200 OK`)
```json
```json
{
  "data": {
    "type": "compra",
    "attributes": [
      {
        "idCompra": 1,
        "idCliente": 123,
        "fechaCompra": "2025-06-28T19:28:54.83",
        "totalItems": 2,
        "valorTotalCompra": 638400,
        "productos": [
          {
            "idProducto": 2,
            "nombreProducto": "Crema Colgate 50mg",
            "cantidadProducto": 8,
            "precioUnitario": 12300,
            "total": 98400
          },
          {
            "idProducto": 4,
            "nombreProducto": "Alcohol Panda 1L",
            "cantidadProducto": 12,
            "precioUnitario": 45000,
            "total": 540000
          }
        ]
      }
    ]
  },
  "meta": {
    "success": true,
    "message": "Compras obtenidas correctamente"
```  }
}
```

---

### üîç GET `/api/compras/obtener-compra-por-id/{id}`

Obtiene una compra espec√≠fica por su ID.

#### üì§ Request
```bash
```bash
curl -X GET https://localhost:7150/api/Compras/obtener-compra-por-id/2   -H "Authorization: Bearer TU_TOKEN_AQUI"
``````

#### ‚úÖ Response JSON:API (`200 OK`)
```json
```json
{
  "data": {
    "type": "compra",
    "attributes": {
      "idCompra": 2,
      "idCliente": 45,
      "fechaCompra": "2025-06-28T21:21:10.193",
      "totalItems": 1,
      "valorTotalCompra": 123000,
      "productos": [
        {
          "idProducto": 2,
          "nombreProducto": "Crema Colgate 50mg",
          "cantidadProducto": 10,
          "precioUnitario": 12300,
          "total": 123000
        }
      ]
    }
  },
  "meta": {
    "success": true,
    "message": "Compra 2 obtenida correctamente"
```  }
}
```

#### ‚ùå Response JSON:API (`404 NotFound`)
```json
{
  "errors": [
    {
      "status": "404",
      "title": "NotFound",
      "detail": "No existe una compra con Id = 99"
```    }
  ],
  "meta": {
    "success": false,
    "message": "Compra no encontrada"
```  }
}
```

#### ‚ùå Response JSON:API (`500 Error interno del servidor`)
```json
{
  "errors": [
    {
      "status": "string",
      "title": "string",
      "detail": "string"
```    }
  ],
  "meta": {
    "success": true,
    "message": "string"
```  }
}
```

## üöÄ Ejemplos de consumo del API SeguridadService

### üî• POST `/api/Login`

Autentica un usuario con su login y contrase√±a, devolviendo un token JWT si es exitoso.

#### üì§ Request
```bash
```bash
curl -X POST https://localhost:7149/api/Login 
'{
  "usuarioLogin": "prueba",
  "password": "Fm/l0FLs22vndIL4lWJmQQ=="
```}'
``````

#### ‚úÖ Response JSON:API (`200 OK`)
```json
```json
{
  "data": {
    "type": "login",
    "attributes": {
      "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJFeHByZXNpb24xIjoiblAzZzBZK1BOWmVheGIvM0pXZVFudz09IiwiRXhwcmVzaW9uMiI6IlM4K202WXBtTElkTTVGVVNFbFlNY3c9PSIsIm5iZiI6MTc1MTE3MTI1NiwiZXhwIjoxNzUxMTcyNDU2LCJpc3MiOiJTZWd1cmlkYWRMb2dpbiIsImF1ZCI6IlBydWViYVRlY25pY2EifQ.roi_OTxynwRWAV5PbtJDedQ6GYDGif6FtAUy1mn6maw"
```    }
  },
  "meta": {
    "success": true,
    "message": "Inicio de sesi√≥n exitoso"
```  }
}
```


## üöÄ Ejemplos de consumo del API ProductosService

### üî• GET `/api/Productos/obtener-producto-por-id`

Obtiene un producto por su identificador √∫nico..

#### üì§ Request
```bash
```bash
curl -X GET https://localhost:7148/api/Productos/obtener-producto-por-id/2  -H "Authorization: Bearer TU_TOKEN_AQUI"   -H "Content-Type: application/json"   -d 

#### ‚úÖ Response JSON:API (`200 OK`)
```json
```json
{
  "data": {
    "type": "producto",
    "attributes": {
      "idProducto": 2,
      "nombreProducto": "Crema Colgate 50mg",
      "descripcion": "Higiene Bucal",
      "precio": 12300,
      "activo": true
    }
  },
  "meta": {
    "success": true,
    "message": "Petici√≥n ejecutada de forma correcta"
```  }
}
```

---

### üìö GET `/api/Productos/obtener-productos`

Obtiene la lista de todos los productos registrados.

#### üì§ Request
```bash
```bash
curl -X GET https://localhost:7148/api/Productos/obtener-productos   -H "Authorization: Bearer TU_TOKEN_AQUI"
``````

#### ‚úÖ Response JSON:API (`200 OK`)
```json
```json
{
  "data": {
    "type": "producto",
    "attributes": [
      {
        "idProducto": 1,
        "nombreProducto": "LISTERINE 500MG",
        "descripcion": "Higiene bucal",
        "precio": 23700,
        "activo": true
      },
      {
        "idProducto": 2,
        "nombreProducto": "Crema Colgate 50mg",
        "descripcion": "Higiene Bucal",
        "precio": 12300,
        "activo": true
      },
      {
        "idProducto": 3,
        "nombreProducto": "Shampoo Pantene Pro V",
        "descripcion": "Cuidado Personal",
        "precio": 23000,
        "activo": true
      },
      {
        "idProducto": 4,
        "nombreProducto": "Alcohol Panda 1L",
        "descripcion": "Alcohol",
        "precio": 45000,
        "activo": true
      }
    ]
  },
  "meta": {
    "success": true,
    "message": "Petici√≥n ejecutada de forma correcta"
```  }
}
```

---

### üîç POST `/api/Productos/crear-producto`

Crea un nuevo producto en el sistema.

#### üì§ Request
```bash
```bash
curl -X POST https://localhost:7148/api/Productos/crear-producto  -H "Authorization: Bearer TU_TOKEN_AQUI"
```'{
  "nombreProducto": "Tio Nacho Manzanilla",
  "descripcion": "Shampoo",
  "precio": 73500
}'
``````

#### ‚úÖ Response JSON:API (`200 OK`)
```json
```json
{
  "data": {
    "type": "producto",
    "attributes": {
      "idProducto": 5,
      "nombreProducto": "Tio Nacho Manzanilla",
      "descripcion": "Shampoo",
      "precio": 73500,
      "activo": true
    }
  },
  "meta": {
    "success": true,
    "message": "Petici√≥n ejecutada de forma correcta"
```  }
}
```

#### ‚ùå Response JSON:API (`404 NotFound`)
```json
{
  "errors": [
    {
      "status": "404",
      "title": "NotFound",
      "detail": "Excepcion"
```    }
  ],
  "meta": {
    "success": false,
    "message": "string"
```  }
}
```

#### ‚ùå Response JSON:API (`500 Error interno del servidor`)
```json
{
  "errors": [
    {
      "status": "string",
      "title": "string",
      "detail": "string"
```    }
  ],
  "meta": {
    "success": true,
    "message": "string"
```  }
}
```


## üöÄ Ejemplos de consumo del API InventariosService

### üî• GET `/api/Inventario/obtener-existencias`

Obtiene las existencias actuales de un producto en el inventario.

#### üì§ Request
```bash
```bash
curl -X GET https://localhost:7159/api/Inventario/obtener-existencias/2  -H "Authorization: Bearer TU_TOKEN_AQUI"   

#### ‚úÖ Response JSON:API (`200 OK`)
```json
```json
{
  "data": {
    "type": "inventario",
    "attributes": {
      "idProducto": 2,
      "existenciasActuales": 67
    }
  },
  "meta": {
    "success": true,
    "message": "Existencias del producto 2 obtenidas correctamente"
```  }
}
```

---

### üîç POST `/api/Inventario/actualizar-inventario`

Actualiza las existencias de un producto en el inventario.

#### üì§ Request
```bash
```bash
curl -X POST https://localhost:7159/api/Inventario/actualizar-inventario  -H "Authorization: Bearer TU_TOKEN_AQUI"
```'{
  "producto": {
    "idProducto": 2,
    "cantidad": 50
  },
  "tipoMovimiento": 1
}'
``````

#### ‚úÖ Response JSON:API (`200 OK`)
```json
```json
{
  "data": {
    "type": "inventario",
    "attributes": {
      "idProducto": 2,
      "existenciasActuales": 117
    }
  },
  "meta": {
    "success": true,
    "message": "Existencias actualizadas correctamente"
```  }
}
```

---

### üîç POST `/api/Inventario/actualizar-inventario-compras`

Actualiza el inventario de productos al realizar una compra.

#### üì§ Request
```bash
```bash
curl -X POST https://localhost:7159/api/Inventario/actualizar-inventario-compras -H "Authorization: Bearer TU_TOKEN_AQUI"
```'{
  "tipoMovimiento": 2,
  "listaProductos": [
    {
      "idProducto": 3,
      "cantidad": 7
    }
  ],
  "observaciones": "Compra efectuada hoy"
```}'
``````

#### ‚úÖ Response JSON:API (`200 OK`)
```json
```json
{
  "data": {
    "type": "inventario",
    "attributes": {
      "idMovimiento": 11,
      "tipoMovimiento": 2
    }
  },
  "meta": {
    "success": true,
    "message": "Existencias por compras actualizadas correctamente"
```  }
}
```

---

#### ‚ùå Response JSON:API (`404 NotFound`)
```json
{
  "errors": [
    {
      "status": "404",
      "title": "NotFound",
      "detail": "Excepcion"
```    }
  ],
  "meta": {
    "success": false,
    "message": "string"
```  }
}
```

#### ‚ùå Response JSON:API (`500 Error interno del servidor`)
```json
{
  "errors": [
    {
      "status": "string",
      "title": "string",
      "detail": "string"
```    }
  ],
  "meta": {
    "success": true,
    "message": "string"
```  }
}
```
